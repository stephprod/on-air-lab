<% include header %>
  		
    <section class="short-image no-padding blog-short-title">
		<div class="container">
			<div class="row">
				<div class="col-xs-12 col-lg-12 short-image-title">
					<h5 class="subtitle-margin second-color">Tableau de bord</h5>
					<h1 class="second-color">mes images</h1>
					<div class="short-title-separator"></div>
				</div>
			</div>
		</div>
    </section>
	
	<section class="section-light section-top-shadow">
		<div class="container">
			<div class="row">
				<div class="col-xs-12 col-md-3 col-md-push-1">
					<div class="sidebar-left">
						<h3 class="sidebar-title">Bon retour parmis nous<span class="special-color">.</span></h3>
						<div class="title-separator-primary"></div>
						
						<div class="profile-info margin-top-60">
							<div class="profile-info-title negative-margin"><%= locals.session.userFirstName %> <%= locals.session.userName %></div>
							<img src="<%= locals.etabObj.length > 0 ? locals.etabObj[0].path_img : '/asset/content/img/default_pro_profile.jpeg' %>" alt="" class="pull-left" />
							<div class="profile-info-text pull-left">
								<p class="subtitle-margin">
									<% if (locals.session.userType == 2){ %> 
										Professionnel Audio
									<% }else if(locals.session.userType == 3){ %>
										Professionnel Vidéo
									<% }else{ %>
										Administrateur
									<% } %>
								</p>
								
								<a href="#logout-modal" class="logout-link margin-top-30" data-toggle="modal"><i class="fas fa-lg fa-sign-out-alt"></i>Se déconnecter</a>
							</div>
							<div class="clearfix"></div>
						</div>
						<div class="center-button-cont margin-top-30">
							<a href="/agenda" class="button-primary button-shadow button-full">
								<span>Mon Agenda</span>
								<div class="button-triangle"></div>
								<div class="button-triangle2"></div>
								<div class="button-icon"><i class="fas fa-calendar-alt"></i></div>
							</a>
						</div>
						<div class="center-button-cont margin-top-15">
							<a href="/info-pro" class="button-primary button-shadow button-full">
								<span>Mon profile</span>
								<div class="button-triangle"></div>
								<div class="button-triangle2"></div>
								<div class="button-icon"><i class="fa fa-user"></i></div>
							</a>
						</div>
						<div class="title-separator-primary"></div>
						<div class="center-button-cont margin-top-15">
							<a href="#pro-payment-modal" data-toggle="modal" class="button-primary button-shadow button-full">
								<span>Mes abonnements</span>
								<div class="button-triangle"></div>
								<div class="button-triangle2"></div>
								<div class="button-icon"><i class="fa fa-th-list"></i></div>
							</a>
						</div>
						<div class="center-button-cont margin-top-15">
							<a href="#" id="redirectAdmin" class="button-alternative button-shadow button-full">
								<span>Une reclamation</span>
								<div class="button-triangle"></div>
								<div class="button-triangle2"></div>
								<div class="button-icon"><i class="jfont fa-lg">&#xe804;</i></div>
							</a>
						</div>
						
					</div>
				</div>
				<div id="images" data-profil="<%= locals.etabObj.length > 0 ? locals.etabObj[0].id_profil : 0 %>" class="col-xs-12 col-md-9 col-md-push-1">
					<div class="msg-profile">
					</div>
					<div class="col-xs-12 margin-top-60">
						<h3 class="title-negative-margin">galerie de photos<span class="special-color">.</span></h3>
						<div class="title-separator-primary"></div>
					</div>
					<div class="col-xs-12 margin-top-60">
						<input id="file-upload" name="uploaded_file" type="file" multiple />
					</div>
					<div class="col-xs-12">
						<div class="center-button-cont margin-top-60 upload-files-msg">
							<a data-action="images" href="#" class="button-primary button-shadow" data-form="images">
								<span>Valider les modifications</span>
								<div class="button-triangle"></div>
								<div class="button-triangle2"></div>
								<div class="button-icon"><i class="fa fa-paper-plane"></i></div>
							</a>
						</div>
					</div>
					<div class="row col-xs-12 margin-top-60" style="display:inline-block; padding:5px;background: whitesmoke;" id="docImg">
					<% for (k in locals.etabObj){ %>
					<% if(locals.etabObj[k].path){ %>
					<div class="file-preview-thumbnails">
						<div class="file-preview-frame" id="preview-1541678623004-0" data-fileindex="0">
						   <img src="<%= locals.etabObj[k].path %>" class="file-preview-image" title="Capture.PNG" alt="Capture.PNG" style="width:auto;height:160px;">
						   <div class="file-thumbnail-footer">
							   <div class="file-actions">
									<div class="file-footer-buttons" style="position: absolute; right: 0; bottom: 0;">
										<button type="button" onclick="removeFile('<%= locals.etabObj[k].path %>')" style="background: #c6454a;" class="kv-file-remove btn btn-xs btn-default" title="Remove file"><i class="glyphicon glyphicon-trash" style="color:#ffff"></i></button>
									</div>
									<div class="clearfix"></div>
								</div>
							</div>
						</div>
					</div><% }
					} %>
				</div>
			</div>
			</div>			
		</div>
	</div>
	</section>
	<script>
		function update_front_with_msg(ret, dataName){
			$('.global_msg').remove();
			var content = "";
			$.each(ret, function (ind, val){
				var elem = $("."+dataName);
				//console.log(elem);
				//elem.after();
				if (ind == "global_msg"){
					content += '<div class="global_msg">';
					$.each(val, function (i, v){
						if (!ret.success[i])
							content += '<div class="error-box"><p style="margin:0;">'+v+'</p><div class="small-triangle"></div><div class="small-icon"><i class="jfont">&#xe80f;</i></div></div>';
						else{
							content += '<div class="success-box"><p style="margin:0;">'+v+'</p><div class="small-triangle"></div><div class="small-icon"><i class="jfont">&#xe816;</i></div></div>';
						}
					});
					content += '</div>';
					//console.log(content);
					elem.after(content);		
				}
			});
			//$('[data-toggle="tooltip"]').tooltip();
		}
		function removeFile(path_img){    		
			event.preventDefault();
			var div = $("div#images");
			var nodeImg = event.target.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode
			var datas = {}
			datas.file_profileId = div.data("profil");
			datas.path = path_img
			if (datas.file_profileId != 0){
				$.ajax({
					type: "POST",
					url: '/delete-in-serv',
					data: datas,
					beforeSend: function (req){
						req.setRequestHeader("x-access-token", "<%- locals.session.token %>");
					},
					success : function(data){
						update_front_with_msg(data, "upload-files-msg");
						$.ajax({
							type: "POST",
							url: '/delete-files',
							beforeSend: function (req){
								req.setRequestHeader("x-access-token", "<%- locals.session.token %>");
							},
							data: datas,
							success: function(data){
								update_front_with_msg(data, "upload-files-msg");
								nodeImg.remove();
							}
						});
					}
				});
			}else{
				update_front_with_msg({success: [false], global_msg: ["Veuillez remplir votre profile avant de modifier votre galerie d'images !"]}, "upload-files-msg");
			}
		}
    </script>
	<% include footer %>